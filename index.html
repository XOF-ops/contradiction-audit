import React, { useState } from 'react';
import { ArrowDown, AlertTriangle, Zap, GitBranch, Cpu, Loader, ShieldCheck } from 'lucide-react';

const ContradictionAudit = () => {
  const [statedValue, setStatedValue] = useState("THE MISSION");
  const [incentivizedValue, setIncentivizedValue] = useState("THE BUDGET");
  const [analysis, setAnalysis] = useState(null);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState(null);

  // --- LOCAL HEURISTIC ENGINE (No API Required) ---
  const generateStaticAnalysis = (stated, incentivized) => {
    // 1. Calculate "Entropy Score" based on string divergence (Simulated metric)
    const entropyLevel = Math.floor(Math.random() * (98 - 75) + 75); 
    
    // 2. Logic Templates aligned with MASTER_BRAIN Axioms
    const frictionTemplates = [
      `Structural Entropy Detected: ${entropyLevel}%. The system broadcasts "${stated}" to maintain legitimacy, but strictly enforces "${incentivized}" to maintain power.`,
      `You are operating in a Dual-Reality. The cognitive load of pretending that "${stated}" matters while "${incentivized}" rules is the exact source of your fatigue.`,
      `The mechanism is broken. The institution demands you perform "${stated}" but only allocates resources for "${incentivized}". You are subsidizing this gap with your own sanity.`
    ];

    const burnoutTemplates = [
      `Burnout Diagnosis: Your internal engine is overheating because you are trying to manually bridge the gap between Rhetoric and Reality.`,
      `The Heat Signal is valid. You are attempting to embody "${stated}" in an environment designed solely for "${incentivized}". Resistance is futile without a pivot.`,
      `You are paying a "Truth Tax" daily. The system outsources its hypocrisy to your nervous system.`
    ];

    const strategyTemplates = [
      `Lethal Necessity: DECOUPLE immediately. Stop trying to save the "${stated}". Deliver the "${incentivized}" efficiently to buy your freedom, then build "${stated}" elsewhere.`,
      `Strategic Exit: The system cannot be fixed from the bottom. Your pivot is to treat "${incentivized}" as the transaction fee, while relocating your identity outside this loop.`,
      `Action Protocol: Re-negotiate the contract. If they want "${stated}", they must fund it. If they only pay for "${incentivized}", stop offering the premium service of your soul.`
    ];

    // 3. Select Template Deterministically based on input length to feel consistent
    const idx = (stated.length + incentivized.length) % 3;

    return `
• FRICTION (The Lie):
${frictionTemplates[idx]}

• BURNOUT (The Cost):
${burnoutTemplates[idx]}

• PIVOT (The Exit):
${strategyTemplates[idx]}
    `;
  };

  const handleAnalyze = async () => {
    if (!statedValue || !incentivizedValue) return;

    setLoading(true);
    setError(null);
    setAnalysis(null);

    // Simulate Processing Delay for User Experience (The "Scan")
    setTimeout(() => {
      try {
        const result = generateStaticAnalysis(statedValue, incentivizedValue);
        setAnalysis(result);
        setLoading(false);
      } catch (err) {
        setError("Local Logic Failure");
        setLoading(false);
      }
    }, 1500);
  };

  return (
    <div className="flex items-center justify-center p-4 md:p-8 bg-slate-950 min-h-[600px] w-full font-sans">
      <div className="relative bg-black border border-slate-800 p-6 md:p-8 rounded-lg shadow-2xl max-w-3xl w-full">
        
        {/* Header */}
        <div className="absolute top-0 left-0 bg-slate-900 text-slate-500 text-[10px] md:text-xs font-mono px-3 py-1 rounded-br border-b border-r border-slate-800 flex items-center gap-2">
          <ShieldCheck className="w-3 h-3 text-emerald-500" />
          MASTER_BRAIN v10.0 | MODULE A: STANDALONE CORE
        </div>

        {/* Top Layer: The Split Reality (Inputs) */}
        <div className="flex flex-col md:flex-row justify-between items-stretch gap-4 md:gap-8 mb-12 mt-8">
          
          {/* Box 1: Stated Input */}
          <div className="flex-1 border-2 border-cyan-900/50 bg-cyan-950/10 p-4 rounded text-center relative group transition-colors focus-within:border-cyan-500/50">
            <div className="text-xs text-cyan-500 font-bold tracking-widest uppercase mb-2">STATED VALUE</div>
            <input 
              type="text" 
              value={statedValue}
              onChange={(e) => setStatedValue(e.target.value)}
              className="w-full bg-transparent text-white font-mono text-lg text-center focus:outline-none border-b border-cyan-900/30 focus:border-cyan-500 placeholder-cyan-900/50"
              placeholder="e.g. INNOVATION"
            />
            <div className="text-slate-500 text-[10px] mt-2 italic">(What they say)</div>
          </div>

          {/* Box 2: Incentivized Input */}
          <div className="flex-1 border-2 border-emerald-900/50 bg-emerald-950/10 p-4 rounded text-center relative group transition-colors focus-within:border-emerald-500/50">
            <div className="text-xs text-emerald-500 font-bold tracking-widest uppercase mb-2">INCENTIVIZED VALUE</div>
            <input 
              type="text" 
              value={incentivizedValue}
              onChange={(e) => setIncentivizedValue(e.target.value)}
              className="w-full bg-transparent text-white font-mono text-lg text-center focus:outline-none border-b border-emerald-900/30 focus:border-emerald-500 placeholder-emerald-900/50"
              placeholder="e.g. COMPLIANCE"
            />
            <div className="text-slate-500 text-[10px] mt-2 italic">(What they pay for)</div>
          </div>
        </div>

        {/* The Friction Zone (Trigger Button) */}
        <div className="relative flex justify-center items-center -mt-8 mb-8 z-10">
           <div className="absolute w-full h-px bg-slate-800 top-1/2 -z-10"></div>
           
           <button 
             onClick={handleAnalyze}
             disabled={loading}
             className="group bg-black border border-red-500/50 hover:border-red-500 p-1 rounded-full cursor-pointer transition-all hover:scale-110 disabled:opacity-50 disabled:hover:scale-100"
           >
             <div className="bg-red-950/30 p-3 rounded-full group-hover:bg-red-900/50 transition-colors">
                {loading ? <Loader className="w-8 h-8 text-red-500 animate-spin" /> : <Zap className="w-8 h-8 text-red-500" />}
             </div>
           </button>
           
           <div className="absolute top-14 text-red-500 font-mono text-[10px] tracking-widest bg-black px-2 uppercase">
             {loading ? "PROCESSING..." : "RUN LOCAL AUDIT"}
           </div>
        </div>

        {/* Analysis Output Section */}
        {analysis && (
          <div className="mb-8 animate-in fade-in slide-in-from-top-4 duration-500">
            <div className="border border-slate-700 bg-slate-900/50 p-6 rounded-lg font-mono text-sm text-slate-300 leading-relaxed whitespace-pre-line shadow-inner">
              <div className="flex items-center gap-2 text-green-500 mb-4 text-xs font-bold uppercase tracking-wider border-b border-slate-700 pb-2">
                <Cpu className="w-3 h-3" /> MASTER_BRAIN PROTOCOL REPORT
              </div>
              {analysis}
            </div>
          </div>
        )}

        {/* Error State */}
        {error && (
          <div className="mb-8 text-center">
            <div className="inline-flex items-center gap-2 text-red-400 border border-red-900/50 bg-red-950/20 px-4 py-2 rounded text-xs font-mono">
              <AlertTriangle className="w-3 h-3" /> {error}
            </div>
          </div>
        )}

        {/* Bottom Layer: The Outcome Split */}
        <div className="flex justify-between items-start gap-4">
          
          {/* Path A: Burnout */}
          <div className="flex-1 flex flex-col items-center opacity-50">
            <ArrowDown className="w-6 h-6 text-slate-600 mb-2" />
            <div className="border border-slate-700 bg-slate-900 p-3 rounded text-center w-full">
              <div className="text-slate-400 font-bold text-sm">BURNOUT</div>
              <div className="text-[10px] text-slate-500 mt-1">Internalizing the cost</div>
            </div>
          </div>

          {/* Path B: The Pivot */}
          <div className="flex-1 flex flex-col items-center">
            <div className="h-8 w-px bg-amber-500/50 mb-0"></div>
            <ArrowDown className="w-6 h-6 text-amber-500 mb-2" />
            <div className="border border-amber-500/50 bg-amber-950/20 p-3 rounded text-center w-full shadow-[0_0_15px_rgba(245,158,11,0.2)]">
              <div className="flex items-center justify-center gap-2 text-amber-500 font-bold text-sm">
                 <GitBranch className="w-4 h-4" /> LETHAL NECESSITY
              </div>
              <div className="text-[10px] text-amber-200/70 mt-1">Strategic Decoupling</div>
            </div>
          </div>

        </div>

        {/* Footer */}
        <div className="mt-8 pt-4 border-t border-slate-900 flex justify-between items-center">
          <div className="text-[10px] text-slate-600 font-mono">
            SYS_MODE: OFFLINE / SECURE
          </div>
          <div className="text-[10px] text-slate-600 font-mono">
            DISTRIBUTION: UNLIMITED
          </div>
        </div>

      </div>
    </div>
  );
};

export default ContradictionAudit;
